<?xml version="1.0" encoding="UTF-8" ?>
<templates>

    <t t-name="vitech.theme.ListRenderer" t-inherit="web.ListRenderer" t-inherit-mode="extension">
        <xpath expr="//div[@t-ref='root']" position="replace">
            <t t-set="_canSelectRecord" t-value="canSelectRecord"/>
            <div class="o_group_picker o_list_renderer px-md-3 px-3" t-ref="root">
                <div class="table "
                     t-att-class="uniqueRendererClass"
                     tabindex="-1"
                     t-ref="table">
                    <div class="row hidden-md-up justify-content-center ui-sortable px-0">
                        <t t-call="{{ constructor.rowsTemplate }}">
                            <t t-set="list" t-value="props.list"/>
                        </t>
                    </div>
                </div>
            </div>
        </xpath>
    </t>


    <t t-name="vitech.theme.ListRenderer.Rows">
        <t t-if="!list.isGrouped">
            <t t-foreach="list.records" t-as="item" t-key="item.id">
                <t t-call="{{ constructor.recordRowTemplate }}"/>
            </t>
            <tr t-if="displayRowCreates">
                <td t-if="withHandleColumn"/>
                <td t-att-colspan="withHandleColumn ? nbCols - 1 : nbCols"
                    class="o_field_x2many_list_row_add"
                    t-on-keydown="(ev) => this.onCellKeydown(ev, null)">
                    <t t-foreach="creates" t-as="create" t-key="create_index">
                        <a t-if="create.type === 'create'"
                           href="#"
                           role="button"
                           t-att-class="create_index !== 0 ? 'ml16' : ''"
                           t-att-tabindex="props.list.editedRecord ? '-1' : '0'"
                           t-on-click.stop.prevent="() => this.add({ context: create.context })">
                            <t t-esc="create.string"/>
                        </a>
                        <ViewButton t-if="create.type === 'button'"
                                    className="`${create.className} ${create_index !== 0 ? 'ml16' : ''}`"
                                    clickParams="create.clickParams"
                                    icon="create.icon"
                                    record="props.list"
                                    string="create.string"
                                    title="create.title"
                                    tabindex="props.list.editedRecord ? '-1' : '0'"/>
                    </t>
                </td>
            </tr>
            <t t-if="!props.list.isGrouped">
                <tr t-foreach="getEmptyRowIds" t-as="emptyRowId" t-key="emptyRowId">
                    <td t-att-colspan="nbCols" t-attf-class="border-0">&#8203;</td>
                </tr>
            </t>
        </t>
        <t t-else="">
            <t t-foreach="list.groups" t-as="group" t-key="group.id">
                <t t-call="{{ constructor.groupRowTemplate }}"/>
                <t t-if="!group.isFolded">
                    <t t-call="{{ constructor.rowsTemplate }}">
                        <t t-set="list" t-value="group.list"/>
                    </t>
                    <tr t-if="!group.list.isGrouped and props.editable and canCreate">
                        <td t-if="hasSelectors"/>
                        <td t-att-colspan="hasSelectors ?  nbCols - 1 : nbCols"
                            class="o_group_field_row_add">
                            <a href="#"
                               role="button"
                               t-on-click.stop.prevent="() => group.addNewRecord({}, props.editable === 'top')"
                               t-on-keydown="(ev) => this.onCellKeydown(ev)">
                                Add a line
                            </a>
                        </td>
                    </tr>
                </t>
            </t>
        </t>
    </t>

    <t t-name="vitech.theme.ListRenderer.GroupRow">
        <tr t-attf-class="{{group.count > 0 ? 'o_group_has_content' : ''}} o_group_header {{!group.isFolded ? 'o_group_open' : ''}} cursor-pointer border d-flex my-1 p-0 justify-content-between w-lg-75"
            t-on-click="() => this.toggleGroup(group)">
            <div class="col" t-attf-class="o_group_caret_theme"
                 t-attf-style="--o-list-group-level: {{getGroupLevel(group)}}">
                <div class="row px-3">
                    <th t-on-keydown="(ev) => this.onCellKeydown(ev, group)"
                        tabindex="-1"
                        t-attf-class="o_group_name fs-6 fw-bold p-0 border-0 {{!group.isFolded ? 'text-900' : 'text-700'}}"
                        t-att-colspan="getGroupNameCellColSpan(group)">
                        <div class="d-flex align-items-center fs-2">
                            <t t-esc="getGroupDisplayName(group)"/>
                            <div class="my-circle-class m-1"
                                 t-attf-style="--o-list-group-level: {{getGroupLevel(group)}}">+
                                <t t-esc="group.count"/>
                            </div>
                            <div t-if="(groupByButtons[group.groupByField.name] and !group.isFolded and group.record.resId)"
                                 class="o_group_buttons">
                                <t t-foreach="groupByButtons[group.groupByField.name]" t-as="button" t-key="button.id">
                                    <t t-if="!evalInvisible(button.invisible, group.record)">
                                        <div class="">
                                            <t t-if="button.clickParams.type === 'edit'">
                                                <button t-att-title="button.title" class="btn"
                                                        t-on-click="() => this.editGroupRecord(group)"
                                                        tabindex="-1">
                                                    <i t-attf-class="fa fa-fw {{button.icon}} o_button_icon"/>
                                                </button>
                                            </t>
                                            <t t-else="">
                                                <ViewButton className="button.className"
                                                            clickParams="button.clickParams"
                                                            icon="button.icon"
                                                            record="group.record"
                                                            string="button.string"
                                                            title="button.title"
                                                            tabindex="'-1'"/>
                                            </t>
                                        </div>
                                    </t>
                                </t>
                            </div>
                            <div t-if="showGroupPager(group)" class="ms-auto">
                                <Pager t-props="getGroupPagerProps(group)"/>
                            </div>
                        </div>
                    </th>
                </div>
                <div class="row d-flex ms-0">
                    <td t-on-keydown="(ev) => this.onCellKeydown(ev, group)" t-foreach="getAggregateColumns(group)"
                        t-as="column"
                        t-key="column.id" t-att-class="{'o_list_number col-md-2 p-0': column.type === 'field'}"
                        class="border-0">
                        <t t-if="column.type === 'field'" t-esc="column.label"/>:
                        <t t-if="column.type === 'field'" t-esc="formatAggregateValue(group, column)"/>
                    </td>
                </div>
            </div>
            <div class="d-flex align-items-center">
                <span t-attf-class=" fa fa-fw {{group.isFolded ? 'fa-caret-right' : 'fa-caret-down' }} m-1"/>
            </div>
        </tr>
    </t>

    <t t-name="vitech.theme.ListRenderer.RecordRow">
        <div class="row p-0 m-2 my-1 card-theme-margin-mobile w-100">
            <div class="pe-auto rounded rounded-4 d-flex card_list_theme position-relative w-lg-75 m-auto p-md-2 p-1"
                 t-on-click="(ev) => this.openRecord(item,ev)">
                <div class="row d-flex m-2 w-100">
                    <t t-set="index" t-value="0"/>
                    <t t-foreach="getColumns(item)" t-as="column" t-key="column.id">
                        <t t-set="isInvisible"
                           t-value="evalInvisible(column.invisible, item) or !(column.name in item.data)"/>
                        <t t-if="!isInvisible">
                            <div t-on-keydown="(ev) => this.onCellKeydown(ev, group, item)"
                                 class="o_data_cell cursor-pointer col-6 col-md-3  p-md-1 p-1"
                                 t-att-class="getCellClass(column, item)"
                                 t-att-name="column.name"
                                 t-att-colspan="column.colspan"
                                 t-att-data-tooltip="!isInvisible ? getCellTitle(column, item) : false"
                                 data-tooltip-delay="1000"
                                 t-on-click="(ev) => this.onCellClicked(item, column, ev)" tabindex="-1">
                                <t t-if="!isInvisible">
                                    <div class="o_data_row">
                                        <div class="row d-flex m-2 fw-bold"
                                             style="font-size:16px; font-size: 16px;white-space: nowrap;text-overflow: ellipsis;">
                                            <t t-if="index == 0">
                                                <div t-on-keydown="(ev) => this.onCellKeydown(ev, group, item)"
                                                     t-if="hasSelectors"
                                                     class="o_list_record_selector user-select-none w-auto p-0"
                                                     t-on-click.stop="() => this.toggleRecordSelection(item)"
                                                     tabindex="-1">
                                                    <CheckBox disabled="!_canSelectRecord" value="item.selected"
                                                              onChange.alike="() => this.toggleRecordSelection(item)"
                                                              className="'pe-0'"/>
                                                </div>
                                            </t>
                                            <t t-set="index" t-value="index + 1"/>
                                            <t t-out="getStringLableField(column)"/>
                                        </div>
                                        <div t-attf-class="d-flex m-2 p-2 px-2 {{column.widget == 'badge' ? '' : 'bg-white'}}"
                                             style="min-height: 37px; border-radius: 1.375rem !important;align-items: center;font-size:16px;overflow: hidden;text-overflow: ellipsis;white-space: nowrap;">
                                            <t t-if="column.widget == 'badge'">
                                                <i class=" fa fa-tag me-1 column-mobile-hidden"></i>
                                            </t>
                                            <span class="w-100" style="text-overflow: ellipsis; overflow: hidden">

                                                <t t-if="canUseFormatter(column, item)"
                                                   t-out="getFormattedValue(column, item)"/>
                                                <Field t-else="" name="column.name" record="item"
                                                       type="getTypeFieldNodes(column)"
                                                       class="getFieldClass(column)" fieldInfo="column"
                                                       t-props="getFieldProps(item, column)"/>
                                            </span>
                                        </div>
                                    </div>
                                </t>
                            </div>
                        </t>
                        <t t-if="column.type === 'button_group'">
                            <td t-on-keydown="(ev) => this.onCellKeydown(ev, group, item)"
                                class="o_data_cell cursor-pointer" t-att-class="getCellClass(column, item)"
                                t-on-click="(ev) => this.onButtonCellClicked(item, column, ev)" tabindex="-1">
                                <t t-foreach="column.buttons" t-as="button" t-key="button.id">
                                    <ViewButton t-if="!evalInvisible(button.invisible, item)"
                                                className="button.className"
                                                clickParams="button.clickParams"
                                                defaultRank="button.defaultRank"
                                                disabled="button.disabled"
                                                icon="button.icon"
                                                record="item"
                                                string="button.string"
                                                title="button.title"
                                                tabindex="props.list.editedRecord ? '-1' : '0'"
                                                onClick="isX2Many and item.isNew ? displaySaveNotification.bind(this) : ''"
                                    />
                                </t>
                            </td>
                        </t>
                    </t>


                </div>

                <div class="" t-if="hasIsFavorite(item)">
                    <button type="checkbox" t-on-click="()=>this.toggleIsFavorite(item)" value="item.data.is_favorite"
                            t-attf-class=" border-0 rounded-circle o-icon-renderer"
                            style="height:30px; width:30px; background-color: #8BC83F;">
                        <i t-attf-class="fa {{item.data.is_favorite ? 'fa-heart text-danger' : 'fa-heart-o text-white'}}"></i>
                    </button>
                </div>
            </div>
        </div>
    </t>
</templates>
